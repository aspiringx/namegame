{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Speed of Love Timeline Schema",
  "description": "Unity Timeline-inspired schema for organizing Three.js animation sequences with separation of assets and instances",
  "definitions": {
    "Vector3": {
      "type": "array",
      "items": { "type": "number" },
      "minItems": 3,
      "maxItems": 3,
      "description": "[x, y, z] position"
    },
    "TimelineClip": {
      "type": "object",
      "properties": {
        "clipId": { "type": "string", "description": "Unique identifier for this clip" },
        "startFrame": { "type": "integer", "description": "Frame number when clip starts (60fps)" },
        "endFrame": { "type": "integer", "description": "Frame number when clip ends (60fps)" },
        "duration": { "type": "integer", "description": "Duration in frames" },
        "easing": { 
          "type": "string", 
          "enum": ["linear", "easeIn", "easeOut", "easeInOut"],
          "default": "linear"
        },
        "blendIn": { "type": "integer", "description": "Frames to blend in", "default": 0 },
        "blendOut": { "type": "integer", "description": "Frames to blend out", "default": 0 }
      },
      "required": ["clipId", "startFrame", "duration"]
    },
    "CameraTrack": {
      "type": "object",
      "properties": {
        "trackType": { "const": "camera" },
        "trackName": { "type": "string" },
        "clips": {
          "type": "array",
          "items": {
            "allOf": [
              { "$ref": "#/definitions/TimelineClip" },
              {
                "properties": {
                  "position": { "$ref": "#/definitions/Vector3" },
                  "fov": { "type": "number" },
                  "lookAt": { "$ref": "#/definitions/Vector3" }
                }
              }
            ]
          }
        }
      },
      "required": ["trackType", "trackName", "clips"]
    },
    "TransformTrack": {
      "type": "object",
      "properties": {
        "trackType": { "const": "transform" },
        "trackName": { "type": "string" },
        "targetBinding": { "type": "string", "description": "Reference to GameObject/Component" },
        "clips": {
          "type": "array",
          "items": {
            "allOf": [
              { "$ref": "#/definitions/TimelineClip" },
              {
                "properties": {
                  "position": { "$ref": "#/definitions/Vector3" },
                  "rotation": { "$ref": "#/definitions/Vector3" },
                  "scale": { "$ref": "#/definitions/Vector3" }
                }
              }
            ]
          }
        }
      },
      "required": ["trackType", "trackName", "targetBinding", "clips"]
    },
    "OpacityTrack": {
      "type": "object",
      "properties": {
        "trackType": { "const": "opacity" },
        "trackName": { "type": "string" },
        "targetBinding": { "type": "string" },
        "clips": {
          "type": "array",
          "items": {
            "allOf": [
              { "$ref": "#/definitions/TimelineClip" },
              {
                "properties": {
                  "opacity": { "type": "number", "minimum": 0, "maximum": 1 }
                }
              }
            ]
          }
        }
      },
      "required": ["trackType", "trackName", "targetBinding", "clips"]
    },
    "ActivationTrack": {
      "type": "object",
      "properties": {
        "trackType": { "const": "activation" },
        "trackName": { "type": "string" },
        "targetBinding": { "type": "string" },
        "clips": {
          "type": "array",
          "items": {
            "allOf": [
              { "$ref": "#/definitions/TimelineClip" },
              {
                "properties": {
                  "active": { "type": "boolean" }
                }
              }
            ]
          }
        }
      },
      "required": ["trackType", "trackName", "targetBinding", "clips"]
    },
    "NarrationTrack": {
      "type": "object",
      "properties": {
        "trackType": { "const": "narration" },
        "trackName": { "type": "string" },
        "clips": {
          "type": "array",
          "items": {
            "allOf": [
              { "$ref": "#/definitions/TimelineClip" },
              {
                "properties": {
                  "text": { "type": "string" },
                  "voiceFile": { "type": "string" }
                }
              }
            ]
          }
        }
      },
      "required": ["trackType", "trackName", "clips"]
    },
    "EffectTrack": {
      "type": "object",
      "properties": {
        "trackType": { "const": "effect" },
        "trackName": { "type": "string" },
        "targetBinding": { "type": "string" },
        "clips": {
          "type": "array",
          "items": {
            "allOf": [
              { "$ref": "#/definitions/TimelineClip" },
              {
                "properties": {
                  "effectType": { 
                    "type": "string",
                    "enum": ["twinkle", "pulse", "wave", "glow"]
                  },
                  "parameters": { "type": "object" }
                }
              }
            ]
          }
        }
      },
      "required": ["trackType", "trackName", "clips"]
    },
    "TimelineAsset": {
      "type": "object",
      "properties": {
        "assetId": { "type": "string", "description": "Unique identifier for this timeline asset" },
        "assetName": { "type": "string" },
        "description": { "type": "string" },
        "frameRate": { "type": "integer", "default": 60, "description": "Frames per second" },
        "duration": { "type": "integer", "description": "Total duration in frames" },
        "tracks": {
          "type": "array",
          "items": {
            "oneOf": [
              { "$ref": "#/definitions/CameraTrack" },
              { "$ref": "#/definitions/TransformTrack" },
              { "$ref": "#/definitions/OpacityTrack" },
              { "$ref": "#/definitions/ActivationTrack" },
              { "$ref": "#/definitions/NarrationTrack" },
              { "$ref": "#/definitions/EffectTrack" }
            ]
          }
        }
      },
      "required": ["assetId", "assetName", "frameRate", "duration", "tracks"]
    },
    "GameObjectBinding": {
      "type": "object",
      "properties": {
        "bindingId": { "type": "string" },
        "componentType": { 
          "type": "string",
          "enum": ["PrimaryStars", "CentralStar", "BackgroundStars", "HeroConstellationLines", "Camera"]
        },
        "instanceProps": { 
          "type": "object",
          "description": "Component-specific props like count, radius, color, etc."
        }
      },
      "required": ["bindingId", "componentType"]
    },
    "TimelineInstance": {
      "type": "object",
      "properties": {
        "instanceId": { "type": "string" },
        "timelineAssetRef": { "type": "string", "description": "Reference to TimelineAsset.assetId" },
        "sceneNumber": { "integer": "number" },
        "bindings": {
          "type": "array",
          "items": { "$ref": "#/definitions/GameObjectBinding" },
          "description": "Maps track targetBindings to actual GameObjects/Components"
        }
      },
      "required": ["instanceId", "timelineAssetRef", "bindings"]
    }
  },
  "type": "object",
  "properties": {
    "version": { "type": "string", "default": "1.0.0" },
    "projectName": { "type": "string" },
    "assets": {
      "type": "array",
      "items": { "$ref": "#/definitions/TimelineAsset" },
      "description": "Reusable timeline assets (like Unity Timeline Assets)"
    },
    "instances": {
      "type": "array",
      "items": { "$ref": "#/definitions/TimelineInstance" },
      "description": "Scene-specific timeline instances with bindings"
    }
  },
  "required": ["version", "projectName", "assets", "instances"]
}
